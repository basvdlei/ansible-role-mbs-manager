---
- name: Create world data directory
  file:
    path: "{{ mbs_manager_datadir }}/worlds"
    state: directory
    mode: '0755'
    owner: root
    group: root

- name: Restore initial state (optional)
  unarchive:
    creates: "{{ mbs_manager_datadir }}/worlds/{{ mbs_manager_initial_state_name }}/"
    src: "{{ mbs_manager_initial_state_archive }}"
    dest: "{{ mbs_manager_datadir }}/worlds/"
  when:
    - mbs_manager_initial_state_archive is defined
    - mbs_manager_initial_state_name is defined

- name: Copy initial permissions
  copy:
    src: "{{ mbs_manager_permissions_file }}"
    dest: "{{ mbs_manager_datadir }}/permissions.json"
    force: false

- name: Copy initial whitelist
  copy:
    src: "{{ mbs_manager_whitelist_file }}"
    dest: "{{ mbs_manager_datadir }}/whitelist.json"
    force: false

- name: Copy server configuration
  copy:
    src: "{{ mbs_manager_properties_file }}"
    dest: "{{ mbs_manager_datadir }}/server.properties"

- name: Create systemd unit file
  template:
    src: minecraft-bedrock-server.service.j2
    dest: /etc/systemd/system/minecraft-bedrock-server.service
  notify:
    - Restart Minecraft Bedrock Server

- name: Start mbs-manager for Minecraft Bedrock Server
  systemd:
    name: minecraft-bedrock-server
    daemon_reload: true
    state: started
    enabled: yes
